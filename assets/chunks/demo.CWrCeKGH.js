import{ad as ht,f as ct,ap as dt,J as H,j as ut,H as pt,o as ft,c as mt,s as gt}from"./framework.CqQSC6Sp.js";const g=(n,t,e)=>n>=t&&n<=e,bt=n=>{if(typeof n=="number")return g(n,0,1);if(typeof n=="string"){const t=parseFloat(n);return!isNaN(t)&&(n.endsWith("%")?g(t/100,0,1):g(t,0,1))}return!1},z=n=>{const t=n.trim();return t?t.endsWith("%")?Number(t.slice(0,-1))/100*255:Number(t):NaN},vt=n=>typeof n=="string"?yt(n):typeof n=="object"&&n!==null&&xt(n),xt=n=>{const{red:t,green:e,blue:i,alpha:s}=n;return g(t,0,255)&&g(e,0,255)&&g(i,0,255)&&(s===void 0||g(s,0,1))},yt=n=>{const t=n.match(/^rgba?\(\s*(\d{1,3}|[\d.]+%)\s*[, ]\s*(\d{1,3}|[\d.]+%)\s*[, ]\s*(\d{1,3}|[\d.]+%)\s*(?:[,/]\s*([01]?\.?\d+%?))?\s*\)$/);if(!t)return!1;const[,e,i,s,o]=t,r=z(e),l=z(i),a=z(s);return!!(g(r,0,255)&&g(l,0,255)&&g(a,0,255))&&(o===void 0||bt(o))},wt=n=>{const t=n.trim().toLowerCase().match(/^(-?[\d.]+)(deg|rad|grad|turn)?$/);if(!t)return NaN;const e=parseFloat(t[1]),i=t[2];if(isNaN(e))return NaN;let s;switch(i){case"rad":s=180*e/Math.PI;break;case"grad":s=e/400*360;break;case"turn":s=360*e;break;default:s=e}return(s%360+360)%360},et=n=>{if(typeof n=="number"){if(!g(n,0,1))throw new Error("Alpha value must be between 0 and 1");return n}if(typeof n=="string"){const t=n.trim();let e;if(t.endsWith("%")?e=Number(t.slice(0,-1))/100:e=Number(t),isNaN(e))throw new Error(`Invalid alpha value: "${n}"`);if(!g(e,0,1))throw new Error("Alpha value must be between 0 and 1");return e}throw new Error("Invalid alpha value format")},Ct=n=>{if(typeof n!="string")throw new Error("Invalid HSL color format");const t=n.match(/^hsla?\(\s*(-?[\d.]+(?:deg|rad|grad|turn)?)\s*[, ]\s*(-?[\d.]+%?)\s*[, ]\s*(-?[\d.]+%?)\s*(?:[,/]\s*(-?[\d.]+%?))?\s*\)$/i);if(!t)throw new Error("Invalid HSL color format");const[,e,i,s,o]=t,r=wt(e),l=parseFloat(i),a=parseFloat(s);if(isNaN(r)||isNaN(l)||isNaN(a)||!g(l,0,100)||!g(a,0,100))throw new Error("Invalid HSL color values");return o!==void 0?{hue:r,saturation:l,lightness:a,alpha:et(o)}:{hue:r,saturation:l,lightness:a,alpha:1}},Mt=n=>{if(typeof n!="string")throw new Error("Invalid RGB color format");const t=n.match(/^rgba?\(\s*(-?[\d.]+%?)\s*[, ]\s*(-?[\d.]+%?)\s*[, ]\s*(-?[\d.]+%?)\s*(?:[,/]\s*(-?[\d.]+%?))?\s*\)$/i);if(!t)throw new Error("Invalid RGB color format");const[,e,i,s,o]=t,r=z(e),l=z(i),a=z(s);if(!g(r,0,255)||!g(l,0,255)||!g(a,0,255))throw new Error("RGB values must be between 0 and 255");return{red:r,green:l,blue:a,alpha:o!==void 0?et(o):1}},it=n=>{if(typeof n!="string")throw new Error("Invalid Hex color format.");const t=n.match(/^#([0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/i);if(!t)throw new Error("Invalid Hex color format.");let e=t[1];e.length!==3&&e.length!==4||(e=e.split("").map(l=>l+l).join(""));const i=parseInt(e.substring(0,2),16),s=parseInt(e.substring(2,4),16),o=parseInt(e.substring(4,6),16);let r=1;if(e.length===8){const l=parseInt(e.substring(6,8),16);r=Number((l/255).toFixed(2))}return{red:i,green:s,blue:o,alpha:r}},St=n=>{if(typeof n=="string"){if(n.startsWith("#"))return"hex";if(n.startsWith("rgb"))return"rgbString";if(n.startsWith("hsl"))return"hslString"}if(typeof n=="object"&&n!==null){if("red"in n&&"green"in n&&"blue"in n)return"rgb";if("hue"in n&&"saturation"in n&&"lightness"in n)return"hsl"}throw new Error("Invalid color format")},kt=n=>{if(typeof n!="object"||n===null)throw new Error("Invalid color format. Expected an RGB or HSL object.");if("red"in n&&"green"in n&&"blue"in n){const{red:t,green:e,blue:i,alpha:s}=n;return s===void 0||s===1?`rgb(${t}, ${e}, ${i})`:`rgba(${t}, ${e}, ${i}, ${s})`}if("hue"in n&&"saturation"in n&&"lightness"in n){const{hue:t,saturation:e,lightness:i,alpha:s}=n;return s===void 0||s===1?`hsl(${t}, ${e}%, ${i}%)`:`hsla(${t}, ${e}%, ${i}%, ${s})`}throw new Error("Invalid color format. Expected an RGB or HSL object.")},O=n=>{if(!vt(n))throw new Error("Invalid RGB color format");const t=typeof n=="string"?Mt(n):n,{red:e,green:i,blue:s,alpha:o}=t,r=e/255,l=i/255,a=s/255,h=Math.max(r,l,a),c=Math.min(r,l,a),d=h-c;let u=0,m=0;const f=(h+c)/2;if(d!==0){switch(m=f>.5?d/(2-h-c):d/(h+c),h){case r:u=(l-a)/d+(l<a?6:0);break;case l:u=(a-r)/d+2;break;case a:u=(r-l)/d+4}u*=60}return{hue:Math.round(u),saturation:Math.round(100*m),lightness:Math.round(100*f),alpha:o}},Et=n=>{const t=it(n);return O(t)},zt=n=>{const t=St(n);if(t==="hsl")return n;if(t==="rgb")return O(n);if(t==="hex")return Et(n);if(t==="hslString")return Ct(n);if(t==="rgbString")return O(n);throw new Error("Invalid color format")},I=n=>{const t=zt(n);return kt(t)};let D=class{constructor(t,e,i,s,o){this.window=e,this.pointers=i,this.element=s,this.getNthPointer=t.getNthPointer,this.toTargetCoords=t.toTargetCoords,this.augment=t.augment,this.dispatch=t.dispatch,this.options=o}getNthPointer;toTargetCoords;augment;dispatch;options;onPointerDown;onPointerUp;onPointerMove;onWheel;onStart;onStop;dispose;modifiers};function E(n,t=0){return n[n.length-1-t]}function F(n){return Array.isArray(n)?n:[n]}class Dt extends D{#t=-1/0;#e=0;onPointerDown=(t,e,i)=>{i.size===2&&(this.getNthPointer(0).interrupted=!0,e.interrupted=!0)};onPointerUp=(t,e)=>{if(e.interrupted)return;const i=this.options.moveThreshold??5;if(Math.abs(e.records[0].x-t.clientX)>=i||Math.abs(e.records[0].y-t.clientY)>=i)return;const s=E(e.records).timestamp,o=this.options.clickPreserveTime??400;s-this.#t<=o?this.#e++:this.#e=1,this.#t=s;const r=this.toTargetCoords({x:t.clientX,y:t.clientY});this.dispatch("trueClick",{...r,target:e.target,streak:this.#e})}}class Pt extends D{onPointerMove=(t,e,i)=>{const s=E(e.records,1);if(i.size===1){const o=t.clientX-s.x,r=t.clientY-s.y;this.dispatch("drag",{deltaX:o,deltaY:r,x:t.clientX,y:t.clientY})}}}class Nt extends D{#t={lastDistance:0,lastMidpoint:{x:0,y:0}};#e(){const t=E(this.getNthPointer(0).records),e=E(this.getNthPointer(1).records),i=t.x-e.x,s=t.y-e.y;return Math.sqrt(i*i+s*s)}#i(){const t=E(this.getNthPointer(0).records),e=E(this.getNthPointer(1).records);return{x:(t.x+e.x)/2,y:(t.y+e.y)/2}}onPointerDown=(t,e,i)=>{i.size===2&&(this.#t.lastDistance=this.#e(),this.#t.lastMidpoint=this.toTargetCoords(this.#i()))};onPointerMove=(t,e,i)=>{if(i.size===2){const s=this.#e(),o=this.#i(),r=s/this.#t.lastDistance;this.#t.lastDistance=s;const l=this.toTargetCoords(o),a=l.x-this.#t.lastMidpoint.x,h=l.y-this.#t.lastMidpoint.y;this.#t.lastMidpoint=l,this.#s({deltaX:a,deltaY:h}),this.#n(r,l)}};#n(t,e){this.dispatch("zoom",{x:e.x,y:e.y,factor:t})}#s(t){this.dispatch("pan",t)}}let _t=class extends D{onWheel=t=>t.preventDefault();#t=t=>t.preventDefault();onStart=()=>{this.element.style.touchAction="none",this.element.addEventListener("gesturestart",this.#t,{passive:!1}),this.element.addEventListener("gesturechange",this.#t,{passive:!1})};onStop=()=>{this.element.style.touchAction="",this.element.removeEventListener("gesturestart",this.#t),this.element.removeEventListener("gesturechange",this.#t)};dispose=this.onStop};class It extends D{constructor(...t){super(...t),(function(e,i){for(const[s,o]of Object.entries(e))s in i||(i[s]=o)})({proControlSchema:!1,zoomFactor:.1,lockControlSchema:!1},this.options)}onWheel=t=>{const e=this.options;if(e.proControlSchema||e.lockControlSchema||!(t.ctrlKey||t.shiftKey||Math.abs(t.deltaX)>Math.abs(t.deltaY))||(e.proControlSchema=!0),e.proControlSchema)if(t.ctrlKey){const i=1-e.zoomFactor*t.deltaY,s=this.toTargetCoords({x:t.clientX,y:t.clientY});this.#t(i,s)}else t.shiftKey&&Math.abs(t.deltaX)<=Math.abs(t.deltaY)?this.#e({deltaX:-t.deltaY,deltaY:-t.deltaX}):this.#e({deltaX:-t.deltaX,deltaY:-t.deltaY});else{const i=1-e.zoomFactor/20*t.deltaY,s=this.toTargetCoords({x:t.clientX,y:t.clientY});this.#t(i,s)}};#t(t,e){this.dispatch("zoom",{x:e.x,y:e.y,factor:t})}#e(t){this.dispatch("pan",t)}}let Bt=class extends D{#t={};#e=null;constructor(...t){super(...t);const e=this.options.lubricator;e&&Object.entries(e).forEach(([i,s])=>{const o={sample:{},fields:{}};Object.keys(s.fields).forEach(r=>{o.fields[r]={catch:1,release:1}}),this.#t[i]=o,this.modifiers[i]=this.#i(o,s)})}onStart=()=>{this.#e=requestAnimationFrame(this.#s)};onStop=()=>{this.#e&&cancelAnimationFrame(this.#e),this.#e=null,Object.values(this.#t).forEach(t=>{Object.values(t.fields).forEach(e=>{e.release=1,e.catch=1})})};#i=(t,e)=>i=>!!i.lubricated||(t.sample=i,this.#n(t.fields,e.fields,i),!1);#n=(t,e,i)=>{Object.entries(t).forEach(([s,o])=>{if(typeof i[s]!="number")return;const r=e[s].countType;r==="sum"?o.catch+=i[s]:r==="product"&&(o.catch*=i[s])})};#s=()=>{const t=this.#t,e=this.options.lubricator;e&&(Object.entries(t).forEach(([i,s])=>{const o=s.sample;o.lubricated=!0;let r=!1;for(const[l,a]of Object.entries(s.fields)){if(a.catch===1)continue;const h=e[i].fields[l].countType;let c,d,u;h==="sum"?(d=a.catch-a.release,c=Math.abs(d)):(d=a.catch/a.release,c=this.#o(d)-1),c<=e[i].fields[l].diminishBoundary?(r||(r=!0),o[l]=d,a.release=1,a.catch=1):(h==="sum"?(u=d*e[i].decayFactor,a.release+=u):(u=Math.pow(d,e[i].decayFactor),a.release*=u),o[l]=u,r=!0)}r&&this.dispatch(i,o)}),this.#e=requestAnimationFrame(this.#s))};#o=t=>t>1?t:1/t;modifiers={}};const st={decayFactor:.25,fields:{deltaX:{countType:"sum",diminishBoundary:.5},deltaY:{countType:"sum",diminishBoundary:.5}}},At=st,Ot={decayFactor:.25,fields:{factor:{countType:"product",diminishBoundary:.01}}};let Lt=class{#t;#e=new Map;#i={};#n={};#s;#o={};options;get#a(){if(!this.#s)throw new Error("[Pointeract] Window is not defined.");return this.#s}constructor(t,e){const i=F(e||[]);this.#s=t.element.ownerDocument.defaultView,this.#t=t.element,t.coordinateOutput||(t.coordinateOutput="relative"),this.options=t,i.forEach(s=>{const o=new s(this.moduleUtils,this.#a,this.#e,this.#t,this.options);Object.assign(o,{options:t}),this.#i[s.name]=o})}on=(t,e)=>(this.#o[t]||(this.#o[t]=new Set),this.#o[t]?.add(e),this);off(t,e){return this.#o[t]?.delete(e),this}moduleUtils={getNthPointer:t=>{const e=new Error("[Pointeract] Invalid pointer index.");if(t<0||t>=this.#e.size)throw e;let i=0;for(const s of this.#e.values()){if(i===t)return s;i++}throw e},toTargetCoords:t=>{if(this.options.coordinateOutput==="absolute")return t;const e=this.#t.getBoundingClientRect();return t.x-=e.left,t.y-=e.top,this.options.coordinateOutput==="relative"||(t.x/=e.width,t.y/=e.height),t},dispatch:(...t)=>{const e=t[0],i=t[1];let s,o=!0;for(const r of Object.values(this.#i))if(r.modifiers&&e in r.modifiers&&(o=i===void 0?r.modifiers[e]():r.modifiers[e](i),o===!1))return;s=o===!0?i:o,this.#o[e]?.forEach(r=>r(s))},augment:t=>{Object.entries(t).forEach(([e,i])=>this[e]=i)}};dispatch=this.moduleUtils.dispatch;#r(t,...e){Object.values(this.#i).forEach(i=>{const s=i[t];s&&s(...e)})}#l=t=>{if(this.#e.size>=2)return;t.isPrimary&&this.#e.clear();const e={records:[{x:t.clientX,y:t.clientY,timestamp:Date.now()}],target:t.target};this.#e.set(t.pointerId,e),this.#r("onPointerDown",t,e,this.#e)};#h=t=>{const e=this.#e.get(t.pointerId);e&&(e.records.push({x:t.clientX,y:t.clientY,timestamp:Date.now()}),this.#r("onPointerMove",t,e,this.#e))};#c=t=>{const e=this.#e.get(t.pointerId);e&&(this.#e.delete(t.pointerId),this.#r("onPointerUp",t,e,this.#e))};#d=t=>this.#r("onWheel",t);stop=t=>{const e=i=>{if(!(i.name in this.#i))return;const s=this.#i[i.name];s.onStop&&s.onStop(),this.#n[i.name]=s,delete this.#i[i.name]};return t?F(t).forEach(i=>{e(i)}):(this.#t.removeEventListener("pointerdown",this.#l),this.#a.removeEventListener("pointermove",this.#h),this.#a.removeEventListener("pointerup",this.#c),this.#t.removeEventListener("wheel",this.#d),this.#r("onStop")),this};start=t=>{const e=i=>{if(!(i.name in this.#n))return;const s=this.#n[i.name];s.onStart&&s.onStart(),this.#i[i.name]=s,delete this.#n[i.name]};return t?F(t).forEach(i=>{e(i)}):(this.#t.addEventListener("pointerdown",this.#l),this.#a.addEventListener("pointermove",this.#h),this.#a.addEventListener("pointerup",this.#c),this.#t.addEventListener("wheel",this.#d,{passive:!1}),this.#r("onStart")),this};dispose=()=>{this.stop(),this.#s=null,this.#r("dispose"),this.#o={}}};class w{constructor(t,e,i,s,o,r){this.container=t,this.augment=r,this.options=e,this.onStart=i.subscribe,this.onDispose=s.subscribe,this.onRestart=o.subscribe}onStart;onRestart;onDispose;options}const p={round:function(n,t){const e=10**t;return Math.round(n*e)/e},resizeCanvasForDPR:function(n,t,e){const i=window.devicePixelRatio??1,s=n.getContext("2d");if(!s)throw new Error("[JSONCanvasViewer] This error is unexpected, probably caused uncontrollable runtime errors. Please contact the developer and show how to reproduce.");n.width=Math.round(t*i),n.height=Math.round(e*i),s.setTransform(1,0,0,1,0,0),s.scale(i,i)},applyStyles:function(n,t){const e=document.createElement("style");e.innerHTML=t,n.appendChild(e)},drawRoundRect:function(n,t,e,i,s,o){n.beginPath(),n.moveTo(t+o,e),n.lineTo(t+i-o,e),n.quadraticCurveTo(t+i,e,t+i,e+o),n.lineTo(t+i,e+s-o),n.quadraticCurveTo(t+i,e+s,t+i-o,e+s),n.lineTo(t+o,e+s),n.quadraticCurveTo(t,e+s,t,e+s-o),n.lineTo(t,e+o),n.quadraticCurveTo(t,e,t+o,e),n.closePath()},getAnchorCoord:function(n,t){const e=n.x+n.width/2,i=n.y+n.height/2;switch(t){case"top":return{x:e,y:n.y};case"bottom":return{x:e,y:n.y+n.height};case"left":return{x:n.x,y:i};case"right":return{x:n.x+n.width,y:i};default:return{x:e,y:i}}},makeHook:function(n=!1){const t=(...e)=>{n?Array.from(t.subs).reverse().forEach(i=>{i(...e)}):t.subs.forEach(i=>{i(...e)})};return t.subs=new Set,t.subscribe=e=>{t.subs.add(e)},t.unsubscribe=e=>{t.subs.delete(e)},t}},b=new Error("[JSONCanvasViewer] Resource hasn't been set up or has been disposed.");class C extends w{onToggleFullscreen=p.makeHook();data={canvasData:{nodes:[],edges:[]},nodeMap:{},edgeMap:{},canvasBaseDir:"./",nodeBounds:{maxX:0,maxY:0,minX:0,minY:0,width:0,height:0,centerX:0,centerY:0},offsetX:0,offsetY:0,scale:1,container:document.createElement("div")};constructor(...t){super(...t);const e=this.options.container;for(;e.firstElementChild;)e.firstElementChild.remove();e.innerHTML="";const i=this.options.noShadow??!1?e:e.attachShadow({mode:"open"});p.applyStyles(i,".full,.overlay-container .click-layer,.overlay-container .link-iframe,.overlay-container .audio{top:0;left:0;width:100%;height:100%;position:absolute}.flex-center,.overlay-container.markdown-content{display:flex;justify-content:center;align-items:center}.border-shadow-bg{background:var(--background-secondary);border:1px solid var(--border);box-shadow:var(--shadow)}.collapse-button{border-radius:8px;transition:transform .2s,background-color .2s}.collapse-button:hover{background-color:var(--border)}button{cursor:pointer;font-size:18px;height:32px;border:none;transition:var(--containerTransition);text-align:center;width:32px;padding:5px 0}button svg{width:100%;height:100%}.container{--contentTransition: color .2s, opacity .2s, text-shadow .2s, fill .2s;--containerTransition: background .2s, opacity .2s, box-shadow .2s, border .2s, filter .2s, backdrop-filter .2s;color:var(--text);fill:var(--text);stroke:var(--text);background-color:var(--background);position:relative;width:100%;height:100%;overflow:hidden}.container.numb,.container.numb *{pointer-events:none!important}.main-canvas{width:100%;height:100%;transform-origin:top left}.overlays{position:absolute;transform-origin:top left;will-change:transform}.overlay-container{position:absolute;box-sizing:border-box;border-radius:12px;overflow:hidden;-webkit-user-select:none;user-select:none;contain:strict;content-visibility:auto;box-shadow:var(--shadow);background-color:var(--overlay-card);transition:var(--containerTransition)}.overlay-container .overlay-border{box-sizing:border-box;pointer-events:none;position:absolute;color:var(--overlay-border);top:0;left:0;width:100%;height:100%;border-width:1px;border-style:solid;border-radius:12px;transition:var(--containerTransition)}.overlay-container.active{-webkit-user-select:auto;user-select:auto;pointer-events:auto}.overlay-container.active .overlay-border{border:4px solid var(--overlay-active)}.overlay-container .link-iframe,.overlay-container .audio{border:none;background:transparent}.overlay-container .click-layer{background:transparent;pointer-events:auto}.overlay-container.active .click-layer{pointer-events:none}.overlay-container img{width:100%;height:100%;object-fit:cover;pointer-events:none}.overlay-container.active img{pointer-events:auto}.overlay-container.markdown-content{position:absolute;padding:0 7px}.overlay-container.markdown-content.rtl{direction:rtl;text-align:right}.overlay-container .parsed-content-wrapper{font-family:sans-serif;box-sizing:border-box;max-width:100%;max-height:100%;padding:10px 6px;pointer-events:none;overflow:hidden;scrollbar-gutter:stable both-edges;display:flex;flex-direction:column;gap:12px}@supports not (scrollbar-gutter: stable both-edges){.overlay-container .parsed-content-wrapper{padding:10px}}.overlay-container.active .parsed-content-wrapper{overflow:auto}::-webkit-scrollbar{width:4px}::-webkit-scrollbar-track{background-color:transparent}::-webkit-scrollbar-thumb{border-radius:2px;background:#ffffff40}::-webkit-scrollbar-thumb:hover{background:#1e1e1ebf}p{font-size:16px;line-height:21px}.parsed-content-wrapper img{width:100%;border-radius:8px}h1{font-size:25px}h2{font-size:23px}h3{font-size:22px}h4{font-size:20px}h5{font-size:19px}h6{font-size:17px}p,h1,h2,h3,h4,h5,h6,ol,ul{margin:0}h1,h2{font-weight:800}h3,h4{font-weight:700}h5,h6{font-weight:600}code{background:#ffffff1a;padding:2px 4px;border-radius:8px}pre code{display:block;box-sizing:border-box;width:100%}pre:has(code),table{margin:6px 0}strong{color:#fe8e7c}em{color:#5affb2}a{text-decoration:none;color:#6dadd0;font-weight:800;font-style:italic;cursor:pointer;transition:var(--contentTransition)}a:hover{color:#86d3fd}hr{height:1px;width:100%;background-color:#fff3;border:none}li{margin:5px 0}ul{padding-left:16px}ol{padding-left:15px;padding-right:7.5px}table{border-collapse:collapse;border-radius:8px;overflow:hidden;width:100%}table th,table td{border:1px solid rgba(255,255,255,.2);padding:6px 10px;background:#ffffff0f;text-align:left}table th{background:#ffffff1f;font-weight:700}"+this.options.extraCSS),this.data.container.classList.add("container"),i.appendChild(this.data.container),this.augment({resetView:this.resetView,shiftFullscreen:this.shiftFullscreen}),this.onStart(this.start),this.onRestart(this.start),this.onDispose(this.dispose)}start=()=>{const t=Object.assign({nodes:[],edges:[]},this.options.canvas);Object.assign(this.data,{canvasData:t,nodeMap:{},edgeMap:{},canvasBaseDir:this.processBaseDir(this.options.attachmentDir),nodeBounds:this.calculateNodeBounds(t),offsetX:0,offsetY:0,scale:1}),this.data.canvasData.nodes.forEach(e=>{const i={ref:e,box:this.getNodeBox(e)};if(this.data.nodeMap[e.id]=i,e.type==="file"){const s=e.file.split("/").pop()??"";i.fileName=s,e.file.startsWith("http://")||e.file.startsWith("https://")||(e.file=this.data.canvasBaseDir+s)}}),this.data.canvasData.edges.forEach(e=>{this.data.edgeMap[e.id]={ref:e,box:this.getEdgeBox(e)}}),this.resetView()};processBaseDir=t=>t?t?.slice(-1)==="/"?t:`${t}/`:"./";getNodeBox=t=>({left:t.x,top:t.type==="file"||t.type==="group"?t.y-40:t.y,right:t.width+t.x,bottom:t.y+t.height});getEdgeBox=t=>{const e=this.data.nodeMap,i=e[t.fromNode].ref,s=e[t.toNode].ref,o=p.getAnchorCoord(i,t.fromSide),r=p.getAnchorCoord(s,t.toSide),l=Math.min(o.x,r.x),a=Math.min(o.y,r.y),h=Math.max(o.x,r.x),c=Math.max(o.y,r.y),d=h-l,u=c-a,m=Math.min(d,u),f=m===0?1:m,y=Math.max(d,u),v=10*Math.log2(y/f);return{left:l-v,top:a-v,right:h+v,bottom:c+v}};calculateNodeBounds(t){let e=1/0,i=1/0,s=-1/0,o=-1/0;t.nodes.forEach(a=>{e=Math.min(e,a.x),i=Math.min(i,a.y),s=Math.max(s,a.x+a.width),o=Math.max(o,a.y+a.height)});const r=s-e,l=o-i;return{minX:e,minY:i,maxX:s,maxY:o,width:r,height:l,centerX:e+r/2,centerY:i+l/2}}shiftFullscreen=async t=>{document.fullscreenElement||t&&t!=="enter"?!document.fullscreenElement||t&&t!=="exit"||(await document.exitFullscreen(),this.onToggleFullscreen(!1)):(await this.data.container.requestFullscreen(),this.onToggleFullscreen(!0))};resetView=()=>{const t=this.data.nodeBounds,e=this.data.container;if(!t||!e)return;const i=t.width+200,s=t.height+200,o=e.clientWidth,r=e.clientHeight,l=o/i,a=r/s,h=Math.round(1e3*Math.min(l,a))/1e3,c={scale:h,offsetX:o/2-t.centerX*h,offsetY:r/2-t.centerY*h};this.data.offsetX=c.offsetX,this.data.offsetY=c.offsetY,this.data.scale=c.scale};middleViewer=()=>{const t=this.data.container;return{x:t.clientWidth/2,y:t.clientHeight/2,width:t.clientWidth,height:t.clientHeight}};dispose=()=>this.data.container.remove()}const V={light:{0:{hue:0,saturation:0,lightness:72},1:{hue:358,saturation:81,lightness:55},2:{hue:19,saturation:87,lightness:58},3:{hue:41,saturation:79,lightness:52},4:{hue:150,saturation:100,lightness:37},5:{hue:221,saturation:100,lightness:59},6:{hue:257,saturation:81,lightness:62}},dark:{0:{hue:0,saturation:0,lightness:40},1:{hue:358,saturation:100,lightness:65},2:{hue:23,saturation:86,lightness:63},3:{hue:39,saturation:91,lightness:70},4:{hue:153,saturation:80,lightness:45},5:{hue:217,saturation:100,lightness:62},6:{hue:259,saturation:100,lightness:75}}},W={light:{dots:"hsla(0, 0%, 72%, 0.4)",text:"rgb(30, 30, 30)",background:"rgb(250, 250, 250)","background-secondary":"rgb(255, 255, 255)",shadow:"0px 0px 8px rgb(0, 0, 0, 0.1)",border:"hsla(0, 0%, 82%, 0.7)"},dark:{dots:"hsla(0, 0%, 40%, 0.3)",text:"rgb(242, 242, 242)",background:"rgb(30, 30, 30)","background-secondary":"rgb(37, 37, 40)",shadow:"0px 0px 8px rgb(0, 0, 0, 0.2)",border:"hsla(0, 0%, 30%, 0.7)"}};class N extends w{theme="light";onChangeTheme=p.makeHook();colorCache={dark:{},light:{}};constructor(...t){super(...t),this.changeTheme(this.options.theme??"light"),this.augment({changeTheme:this.changeTheme})}hslProcessor=t=>{const{hue:e,saturation:i,lightness:s}=t;let o;return o=this.theme==="dark"?{active:t,card:{hue:e,saturation:i/3,lightness:s/3},border:{...t,alpha:.7},background:{...t,alpha:.1},text:t.lightness>=70?"rgb(30, 30, 30)":"rgb(242, 242, 242)"}:{active:t,card:e===0?{hue:e,saturation:i,lightness:100}:{hue:e,saturation:.4*i,lightness:90},border:{...t,alpha:.7},background:{...t,alpha:.1},text:t.lightness>=70?"rgb(30, 30, 30)":"rgb(242, 242, 242)"},{active:I(o.active),card:I(o.card),border:I(o.border),background:I(o.background),text:o.text}};getColor=(t="0")=>{const e=this.theme;let i;return this.colorCache[e][t]?this.colorCache[e][t]:(i=t in V[e]?this.hslProcessor(V[e][t]):this.hslProcessor(O(it(t))),this.colorCache[e][t]=i,i)};getNamedColor=t=>W[this.theme][t];changeTheme=t=>{this.theme=t||(this.theme==="dark"?"light":"dark");const e=this.container.get(C).data.container;Object.entries(W[this.theme]).forEach(([i,s])=>{e.style.setProperty(`--${i}`,s)}),this.onChangeTheme(this.theme)}}class _ extends w{animationId=null;resizeAnimationId=null;DM;SM;resizeObserver;perFrame={lastScale:1,lastOffsets:{x:0,y:0}};lastResizeCenter={x:null,y:null};hooks={onResize:p.makeHook(),onRefresh:p.makeHook()};constructor(...t){super(...t),this.DM=this.container.get(C),this.SM=this.container.get(N),this.resizeObserver=new ResizeObserver(this.onResize),this.SM.onChangeTheme.subscribe(this.refresh),this.augment({refresh:this.refresh}),this.onStart(this.start),this.onRestart(this.refresh),this.onDispose(this.dispose)}start=()=>{this.resizeObserver.observe(this.DM.data.container),this.animationId=requestAnimationFrame(this.draw)};draw=()=>{this.perFrame.lastScale===this.DM.data.scale&&this.perFrame.lastOffsets.x===this.DM.data.offsetX&&this.perFrame.lastOffsets.y===this.DM.data.offsetY||this.refresh(),this.animationId=requestAnimationFrame(this.draw)};refresh=()=>{this.perFrame={lastScale:this.DM.data.scale,lastOffsets:{x:this.DM.data.offsetX,y:this.DM.data.offsetY}},this.hooks.onRefresh()};onResize=()=>{this.resizeAnimationId=requestAnimationFrame(()=>{const t=this.DM.middleViewer();this.lastResizeCenter.x&&this.lastResizeCenter.y&&(this.DM.data.offsetX=this.DM.data.offsetX+t.x-this.lastResizeCenter.x,this.DM.data.offsetY=this.DM.data.offsetY+t.y-this.lastResizeCenter.y),this.lastResizeCenter.x=t.x,this.lastResizeCenter.y=t.y,this.hooks.onResize(t.width,t.height),this.refresh()})};dispose=()=>{this.animationId&&cancelAnimationFrame(this.animationId),this.resizeAnimationId&&cancelAnimationFrame(this.resizeAnimationId),this.resizeObserver.disconnect()}}class nt extends w{_overlaysLayer=document.createElement("div");overlays={};selectedId=null;eventListeners={};DM;SM;parse;get overlaysLayer(){if(!this._overlaysLayer)throw b;return this._overlaysLayer}hooks={onInteractionStart:p.makeHook(),onInteractionEnd:p.makeHook()};constructor(...t){super(...t),this.parse=this.options.markdownParser||(e=>e),this.DM=this.container.get(C),this.SM=this.container.get(N),this.container.get(_).hooks.onRefresh.subscribe(this.updateOverlays),this.SM.onChangeTheme.subscribe(this.themeChanged),this._overlaysLayer=document.createElement("div"),this._overlaysLayer.className="overlays",this._overlaysLayer.id="overlays",this.DM.data.container.appendChild(this.overlaysLayer),this.onStart(this.start),this.onRestart(this.restart),this.onDispose(this.dispose)}start=()=>{this.container.get(R).onClick.subscribe(this.select),this.renderOverlays()};restart=()=>{this.clearOverlays(),this.renderOverlays()};renderOverlays=()=>{const t=async e=>{switch(e.type){case"text":await this.createOverlay(e,e.text,"text");break;case"file":e.file.match(/\.md$/i)?await this.loadMarkdownForNode(e):e.file.match(/\.(png|jpg|jpeg|gif|svg|webp)$/i)?await this.createOverlay(e,e.file,"image"):e.file.match(/\.(mp3|wav)$/i)&&await this.createOverlay(e,e.file,"audio");break;case"link":await this.createOverlay(e,e.url,"link")}};Object.values(this.DM.data.nodeMap).forEach(async e=>{await t(e.ref)})};themeChanged=()=>{Object.values(this.overlays).forEach(t=>{const e=this.DM.data.nodeMap[t.id].ref,i=this.SM.getColor(e.color);this.setOverlayColor(t,i)})};select=t=>{const e=this.selectedId?this.overlays[this.selectedId]:null,i=t?this.overlays[t]:null;e&&e.classList.remove("active"),i?(i.classList.add("active"),this.hooks.onInteractionStart()):this.hooks.onInteractionEnd(),this.selectedId=t};loadMarkdownForNode=async t=>{let e;await this.createOverlay(t,"Loading...","text");try{const i=await fetch(t.file),s=await i.text(),o=s.match(/^---\n([\s\S]*?)\n---\n([\s\S]*)$/);e=o?await this.parse(o[2]):await this.parse(s)}catch(i){console.error("[JSONCanvasViewer] Failed to load markdown:",i),e="Failed to load content."}this.updateOverlay(t,{content:e})};updateOverlays=()=>{const t=this.DM.data;this.overlaysLayer.style.transform=`translate(${t.offsetX}px, ${t.offsetY}px) scale(${t.scale})`};async createOverlay(t,e,i){let s=this.overlays[t.id];s||(s=await this.constructOverlay(t,e,i),this.overlaysLayer.appendChild(s),this.overlays[t.id]=s,s.style.left=`${t.x}px`,s.style.top=`${t.y}px`,s.style.width=`${t.width}px`,s.style.height=`${t.height}px`)}updateOverlay(t,e){const i=this.overlays[t.id];if(e.content){const s=i.getElementsByClassName("parsed-content-wrapper")[0];s&&(s.innerHTML=e.content)}e.color&&this.setOverlayColor(i,e.color)}async constructOverlay(t,e,i){const s=document.createElement("div");switch(s.classList.add("overlay-container"),s.id=t.id,this.setOverlayColor(s,this.SM.getColor(t.color)),i){case"text":{s.classList.add("markdown-content");const a=document.createElement("div");a.innerHTML=await this.parse(e||""),a.classList.add("parsed-content-wrapper"),s.appendChild(a);break}case"link":{const a=document.createElement("iframe");a.src=e,a.sandbox="allow-scripts allow-same-origin",a.className="link-iframe",a.loading="lazy",s.appendChild(a);break}case"audio":{const a=document.createElement("audio");a.className="audio",a.src=e,a.controls=!0,s.appendChild(a);break}case"image":{const a=document.createElement("img");a.src=e,a.loading="lazy",s.appendChild(a)}}switch(i){case"link":case"audio":{const a=document.createElement("div");a.className="click-layer",s.appendChild(a)}}const o=document.createElement("div");o.className="overlay-border",s.appendChild(o);const r=()=>{t.id===this.selectedId&&this.hooks.onInteractionStart()},l=()=>{t.id===this.selectedId&&this.hooks.onInteractionEnd()};return s.addEventListener("pointerenter",r),s.addEventListener("pointerleave",l),s.addEventListener("touchstart",r),s.addEventListener("touchend",l),this.eventListeners[t.id]=[r,l],s}setOverlayColor=(t,e)=>{Object.entries(e).forEach(([i,s])=>{t.style.setProperty(`--overlay-${i}`,s)})};clearOverlays=()=>{Object.entries(this.overlays).forEach(([t,e])=>{if(this.eventListeners[t]){const i=this.eventListeners[t][0],s=this.eventListeners[t][1];if(!i||!s)throw b;e.removeEventListener("pointerenter",i),e.removeEventListener("pointerleave",s),e.removeEventListener("touchstart",i),e.removeEventListener("touchend",s),this.eventListeners[t][0]=null,this.eventListeners[t][1]=null}e.remove(),delete this.overlays[t]})};dispose=()=>{this.clearOverlays(),this.overlaysLayer.remove(),this._overlaysLayer=null}}class R extends w{pointeract;DM;onClick=p.makeHook();constructor(...t){super(...t),this.DM=this.container.get(C);const e=Object.assign(this.options.pointeract??{},{coordinateOutput:"relative",element:this.DM.data.container,lubricator:{pan:st,zoom:Ot,drag:At}});this.pointeract=new Lt(e,[Dt,Pt,It,_t,Nt,Bt]);const i=this.container.get(nt);i.hooks.onInteractionStart.subscribe(this.pointeract.stop),i.hooks.onInteractionEnd.subscribe(this.pointeract.start),this.augment({pan:this.pan,panToCoords:this.panToCoords,zoom:this.zoom,zoomToScale:this.zoomToScale}),this.onStart(this.start),this.onDispose(this.dispose)}start=()=>{this.pointeract.on("pan",this.onPan).on("drag",this.onPan).on("zoom",this.onZoom).on("trueClick",this.onTrueClick).start()};onPan=t=>{this.truePan({x:t.deltaX,y:t.deltaY})};onZoom=t=>{this.trueZoom(t.factor,t)};trueZoom=(t,e)=>{const i=Math.max(Math.min(this.DM.data.scale*t,20),.05);if(i===this.DM.data.scale)return;const s=i/this.DM.data.scale,o=this.C2C(e);this.DM.data.offsetX=e.x-o.x*s,this.DM.data.offsetY=e.y-o.y*s,this.DM.data.scale=i};truePan=({x:t,y:e})=>{this.DM.data.offsetX=this.DM.data.offsetX+t,this.DM.data.offsetY=this.DM.data.offsetY+e};zoom=(t,e)=>{this.pointeract.dispatch("zoom",{factor:t,...e})};pan=({x:t,y:e})=>{this.pointeract.dispatch("pan",{deltaX:t,deltaY:e})};zoomToScale=(t,e)=>{const i=t/this.DM.data.scale;this.pointeract.dispatch("zoom",{factor:i,...e})};panToCoords=({x:t,y:e})=>{this.pointeract.dispatch("pan",{deltaX:t-this.DM.data.offsetX,deltaY:e-this.DM.data.offsetY})};C2C=({x:t,y:e})=>({x:t-this.DM.data.offsetX,y:e-this.DM.data.offsetY});onTrueClick=t=>{const e=t.target;if(this.isUIControl(e))return;const i=this.findNodeId(e);this.onClick(i)};isUIControl=t=>!!t&&(t.closest(".controls")||t.closest("button")||t.closest("input"));findNodeId=t=>{if(!t)return null;let e=t;for(;(!e.id||e.id==="")&&e.parentElement;)e=e.parentElement;return e.id!=="overlays"&&e.id&&e.id!==""?e.id:null};dispose=()=>this.pointeract.dispose()}let Tt=class extends w{_canvas;ctx;DM;SM;zoomInOptimize={lastDrawnScale:0,lastDrawnViewport:{left:0,right:0,top:0,bottom:0},timeout:null,lastCallTime:0};get canvas(){if(this._canvas===null)throw b;return this._canvas}constructor(...t){super(...t);const e=this.container.get(_);this.SM=this.container.get(N),e.hooks.onRefresh.subscribe(this.redraw),e.hooks.onResize.subscribe(this.optimizeDPR),this.DM=this.container.get(C),this._canvas=document.createElement("canvas"),this._canvas.className="main-canvas",this.ctx=this._canvas.getContext("2d"),this.DM.data.container.appendChild(this._canvas),this.onDispose(this.dispose)}optimizeDPR=()=>{const t=this.DM.data.container;p.resizeCanvasForDPR(this.canvas,t.offsetWidth,t.offsetHeight)};redraw=()=>{const t=this.DM.data.offsetX,e=this.DM.data.offsetY,i=this.DM.data.scale,s=this.getCurrentViewport(t,e,i);if(!this.options.zoomInOptimization)return void this.trueRedraw(t,e,i,s);this.zoomInOptimize.timeout&&(clearTimeout(this.zoomInOptimize.timeout),this.zoomInOptimize.timeout=null);const o=Date.now();if(this.isInside(s,this.zoomInOptimize.lastDrawnViewport)&&i!==this.zoomInOptimize.lastDrawnScale&&o-this.zoomInOptimize.lastCallTime<500)return this.zoomInOptimize.timeout=setTimeout(()=>{this.trueRedraw(t,e,i,s),this.zoomInOptimize.lastCallTime=o,this.zoomInOptimize.timeout=null},60),void this.fakeRedraw(s,i);this.zoomInOptimize.lastCallTime=o,this.trueRedraw(t,e,i,s)};trueRedraw(t,e,i,s){this.zoomInOptimize.lastDrawnViewport=s,this.zoomInOptimize.lastDrawnScale=i,this.canvas.style.transform="",this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.save(),this.drawGridDots(i,t,e),this.ctx.translate(t,e),this.ctx.scale(i,i),Object.values(this.DM.data.nodeMap).forEach(o=>{if(this.isOutside(o.box,s))return;const r=o.ref;r.type==="file"?this.drawFile(o):r.type==="group"&&this.drawGroup(r,i)}),Object.values(this.DM.data.edgeMap).forEach(o=>{this.isOutside(o.box,s)||this.drawEdge(o)}),this.ctx.restore()}fakeRedraw(t,e){const i=e/this.zoomInOptimize.lastDrawnScale,s=(this.zoomInOptimize.lastDrawnViewport.left-t.left)*e,o=(this.zoomInOptimize.lastDrawnViewport.top-t.top)*e;this.canvas.style.transform=`translate(${s}px, ${o}px) scale(${i})`}isInside=(t,e)=>t.left>e.left&&t.top>e.top&&t.right<e.right&&t.bottom<e.bottom;isOutside=(t,e)=>t.right<e.left||t.bottom<e.top||t.left>e.right||t.top>e.bottom;getCurrentViewport=(t,e,i)=>{const s=-t/i,o=-e/i,r=this.DM.data.container;return{left:s,top:o,right:s+r.clientWidth/i,bottom:o+r.clientHeight/i}};drawLabelBar=(t,e,i,s,o,r)=>{const l=30*r,a=6*r,h=8*r,c=16*r,d=6*r;this.ctx.save(),this.ctx.translate(t,e),this.ctx.scale(1/r,1/r),this.ctx.font=`${c}px 'Inter', sans-serif`;const u=this.ctx.measureText(i).width+2*d;this.ctx.translate(0,-l-h),this.ctx.fillStyle=s,this.ctx.beginPath(),this.ctx.moveTo(a,0),this.ctx.lineTo(u-a,0),this.ctx.quadraticCurveTo(u,0,u,a),this.ctx.lineTo(u,l-a),this.ctx.quadraticCurveTo(u,l,u-a,l),this.ctx.lineTo(a,l),this.ctx.quadraticCurveTo(0,l,0,l-a),this.ctx.lineTo(0,a),this.ctx.quadraticCurveTo(0,0,a,0),this.ctx.closePath(),this.ctx.fill(),this.ctx.fillStyle=o,this.ctx.fillText(i,d,.65*l),this.ctx.restore()};drawNodeBackground=t=>{const e=this.SM.getColor(t.color);this.ctx.globalAlpha=1,this.ctx.fillStyle=e.background,p.drawRoundRect(this.ctx,t.x+1,t.y+1,t.width-2,t.height-2,12),this.ctx.fill(),this.ctx.strokeStyle=e.border,this.ctx.lineWidth=2,p.drawRoundRect(this.ctx,t.x,t.y,t.width,t.height,12),this.ctx.stroke()};drawGroup=(t,e)=>{if(this.drawNodeBackground(t),t.label){const i=this.SM.getColor(t.color);this.drawLabelBar(t.x,t.y,t.label,i.active,i.text,e)}};drawFile=t=>{this.ctx.fillStyle=this.SM.getColor().text;const e=t.ref;this.ctx.font="16px sans-serif",this.ctx.fillText(t.fileName??"",e.x+5,e.y-10)};drawEdge=t=>{const e=t.ref,i=this.DM.data.nodeMap[e.fromNode].ref,s=this.DM.data.nodeMap[e.toNode].ref,o=p.getAnchorCoord,{x:r,y:l}=o(i,e.fromSide),{x:a,y:h}=o(s,e.toSide),c=this.SM.getColor(e.color);let[d,u,m,f]=[0,0,0,0];if(t.controlPoints?[d,u,m,f]=t.controlPoints:([d,u,m,f]=this.getControlPoints(r,l,a,h,e.fromSide,e.toSide),t.controlPoints=[d,u,m,f]),this.drawCurvedPath(r,l,a,h,d,u,m,f,c.active),this.drawArrowhead(a,h,m,f,c.active),e.label){const v=.125*r+.375*d+.375*m+.125*a,M=(1-.5)**3*l+3*(1-.5)**2*.5*u+3*(1-.5)*.5*.5*f+.5**3*h;this.ctx.font="18px sans-serif";const lt=8,Y=this.ctx.measureText(e.label).width+2*lt,X=20;this.ctx.fillStyle=c.active,this.ctx.beginPath(),p.drawRoundRect(this.ctx,v-Y/2,M-X/2-2,Y,X,4),this.ctx.fill(),this.ctx.fillStyle=c.text,this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText(e.label,v,M-2),this.ctx.textAlign="left",this.ctx.textBaseline="alphabetic"}};getControlPoints=(t,e,i,s,o,r)=>{const l=i-t,a=s-e,h=Math.min(Math.abs(l),Math.abs(a))+.3*Math.max(Math.abs(l),Math.abs(a)),c=(d=.5*h,u=60,m=300,Math.max(u,Math.min(m,d)));var d,u,m;let f=t,y=e,v=i,M=s;switch(o){case"top":y=e-c;break;case"bottom":y=e+c;break;case"left":f=t-c;break;case"right":f=t+c}switch(r){case"top":M=s-c;break;case"bottom":M=s+c;break;case"left":v=i-c;break;case"right":v=i+c}return[f,y,v,M]};drawGridDots=(t,e,i)=>{const s=10*2**-Math.floor(Math.log2(t))*t,o=this.canvas.width,r=this.canvas.height,l=e%s,a=i%s;this.ctx.fillStyle=this.SM.getNamedColor("dots");for(let h=l;h<=o;h+=s)for(let c=a;c<=r;c+=s)this.ctx.beginPath(),this.ctx.arc(h,c,1,0,2*Math.PI),this.ctx.fill()};drawCurvedPath=(t,e,i,s,o,r,l,a,h)=>{this.ctx.beginPath(),this.ctx.moveTo(t,e),this.ctx.bezierCurveTo(o,r,l,a,i,s),this.ctx.strokeStyle=h,this.ctx.lineWidth=2,this.ctx.stroke()};drawArrowhead=(t,e,i,s,o)=>{const r=t-i,l=e-s,a=Math.sqrt(r*r+l*l);if(a===0)return;const h=r/a,c=l/a,d=t-12*h-4*c,u=e-12*c+4*h,m=t-12*h+4*c,f=e-12*c-4*h;this.ctx.beginPath(),this.ctx.fillStyle=o,this.ctx.moveTo(t,e),this.ctx.lineTo(d,u),this.ctx.lineTo(m,f),this.ctx.closePath(),this.ctx.fill()};dispose=()=>{this.zoomInOptimize.timeout&&(clearTimeout(this.zoomInOptimize.timeout),this.zoomInOptimize.timeout=null),this.canvas.remove(),this._canvas=null}};function j(n){return typeof n=="function"}function Ft(n){const t=[];let e=n;for(;Object.getPrototypeOf(e).name;){const i=Object.getPrototypeOf(e);t.push(i),e=i}return t}function B(n){if(n==null)throw Error("Expected value to be not null or undefined");return n}function $t(n,t=2){const e=[];return n.some((i,s)=>{if(s+t>n.length)return!0;e.push(n.slice(s,s+t))}),e}async function Rt(n,t,e){for(;;)try{return await t()}catch(i){if(!(i instanceof n))throw i;await e(i)}}function q(n,t){if(n.length>1)throw t();const e=n.at(0);if(e===void 0)throw t();return e}function jt(n){throw new Error("invalid state")}async function Yt(n){return await new Promise(t=>t(n()))}function P(n){return j(n)}function $(n){return"provide"in n&&"useClass"in n}function Xt(n){return"provide"in n&&"useValue"in n}function ot(n){return"provide"in n&&"useFactory"in n}function U(n){return ot(n)&&n.async===!0}function k(n){return"provide"in n&&"useExisting"in n}function A(n){return"provide"in n&&"multi"in n&&n.multi===!0}class rt{description;options;constructor(t,e){this.description=t,this.options=e}toString(){return`InjectionToken "${String(this.description)}"`}}function G(n){return j(n)}function Ht(n){return n instanceof rt}function x(n){return j(n)?n.name:typeof n=="symbol"?n.description??String(n):n instanceof rt?n.toString():n}function L(n){return P(n)?n:n.provide}const at=Symbol("injectable");function Vt(n){return n.hasOwnProperty(at)}function Wt(n){return n[at]}class qt{container;underConstruction=[];constructor(t){this.container=t}construct(t,e){if(U(t))throw new Z(e);try{if(this.underConstruction.includes(t)){const i=[...this.underConstruction,t].map(L).map(x);throw new J(i)}return this.underConstruction.push(t),this.doConstruct(t)}finally{this.underConstruction.pop()}}async constructAsync(t){try{if(this.underConstruction.includes(t)){const e=[...this.underConstruction,t].map(L).map(x);throw new J(e)}if(this.underConstruction.push(t),U(t))return[await t.useFactory(this.container)];if($(t)||P(t)){const e=P(t)?()=>[new t]:()=>[new t.useClass];return Rt(Z,async()=>e(),async i=>{await this.container.getAsync(i.token,{multi:!0,optional:!0})})}return this.doConstruct(t)}finally{this.underConstruction.pop()}}doConstruct(t){return P(t)?[new t]:$(t)?[new t.useClass]:Xt(t)?[t.useValue]:ot(t)?[t.useFactory(this.container)]:k(t)?this.container.get(t.useExisting,{multi:!0}):jt()}}class Z extends Error{token;constructor(t){super(`Some providers for token ${x(t)} are async, please use injectAsync() or container.getAsync() instead`),this.token=t}}class J extends Error{constructor(t){super(`Detected circular dependency: ${t.join(" -> ")}. Please change your dependency graph or use lazy injection instead.`)}}class Ut{run(){throw new Q}runAsync(){throw new Q}}class Gt{container;constructor(t){this.container=t}run(t){const e=S;try{return S=this,t(this.container)}finally{S=e}}async runAsync(t){const e=S;try{return S=this,await t(this.container)}finally{S=e}}}let S=new Ut;function K(n){return new Gt(n)}class Q extends Error{constructor(){super("You can only invoke inject() or injectAsync() within an injection context")}}class T{providers=new Map;singletons=new Map;parent;factory;constructor(t){this.parent=t,this.factory=new qt(this),this.bind({provide:T,useValue:this})}bindAll(...t){return t.forEach(e=>this.bind(e)),this}bind(t){const e=L(t);if(k(t)&&t.provide===t.useExisting)throw Error(`The provider for token ${x(e)} with "useExisting" cannot refer to itself.`);if(!k(t)&&this.singletons.has(e))throw Error(`Cannot bind a new provider for ${x(e)}, since the existing provider was already constructed.`);if(k(t)&&A(t)&&this.existingProviderAlreadyProvided(e,t.useExisting))return this;const i=this.providers.get(e)??[],s=A(t);if(s&&i.some(o=>!A(o)))throw Error(`Cannot bind ${x(e)} as multi-provider, since there is already a provider which is not a multi-provider.`);if(!s&&i.some(o=>A(o))&&!i.every(k))throw Error(`Cannot bind ${x(e)} as provider, since there are already provider(s) that are multi-providers.`);return this.providers.set(e,s?[...i,t]:[t]),G(e)&&($(t)||P(t))&&$t([e,...Ft(e)]).forEach(([o,r])=>{const l={provide:r,useExisting:o,multi:!0},a=this.providers.get(r)??[];this.existingProviderAlreadyProvided(r,o)||this.providers.set(r,[...a,l])}),this}unbind(t){const e=L(t);return this.providers.delete(e),this.singletons.delete(e),this}unbindAll(){return this.providers.clear(),this.singletons.clear(),this}get(t,e){if(e?.lazy??!1)return()=>this.get(t,{...e,lazy:!1});this.autoBindIfNeeded(t);const s=e?.optional??!1;if(!this.providers.has(t)){if(this.parent)return this.parent.get(t,{...e,lazy:!1});if(s)return;throw Error(`No provider(s) found for ${x(t)}`)}const o=B(this.providers.get(t));this.singletons.has(t)||K(this).run(()=>{const a=o.flatMap(h=>this.factory.construct(h,t));this.singletons.set(t,a)});const r=B(this.singletons.get(t));return e?.multi??!1?r:q(r,()=>Error(`Requesting a single value for ${x(t)}, but multiple values were provided. Consider passing "{ multi: true }" to inject all values, or adjust your bindings accordingly.`))}getAsync(t,e){return e?.lazy??!1?()=>this.getAsync(t,{...e,lazy:!1}):Yt(async()=>{this.autoBindIfNeeded(t);const s=e?.optional??!1;if(!this.providers.has(t)){if(s)return;throw Error(`No provider(s) found for ${x(t)}`)}const o=B(this.providers.get(t));this.singletons.has(t)||await K(this).runAsync(async()=>{const a=await Promise.all(o.map(h=>this.factory.constructAsync(h)));this.singletons.set(t,a.flat())});const r=B(this.singletons.get(t));return e?.multi??!1?r:q(r,()=>new Error(`Requesting a single value for ${x(t)}, but multiple values were provided. Consider passing "{ multi: true }" to inject all values, or adjust your bindings accordingly.`))})}createChild(){return new T(this)}has(t){return this.providers.has(t)||(this.parent?.has(t)??!1)}autoBindIfNeeded(t){if(!this.singletons.has(t)){if(G(t)&&Vt(t))Wt(t).filter(i=>!this.providers.has(i)).forEach(i=>{this.bind({provide:i,useClass:i,multi:!0})});else if(!this.providers.has(t)&&Ht(t)&&t.options?.factory){const e=t.options.async;e?e&&this.bind({provide:t,async:!0,useFactory:t.options.factory}):this.bind({provide:t,async:!1,useFactory:t.options.factory})}}}existingProviderAlreadyProvided(t,e){return(this.providers.get(t)??[]).some(i=>k(i)&&i.provide===t&&i.useExisting===e)}}class Zt{allModules;IO=null;onDispose=p.makeHook(!0);onStart=p.makeHook();onRestart=p.makeHook();started=!1;options;container;constructor(t,e){this.container=new T,this.options=t,this.allModules=[C,N,_,nt,R,Tt,...e??[]],this.allModules.forEach(s=>{this.container.bind({provide:s,useFactory:()=>new s(this.container,this.options,this.onStart,this.onDispose,this.onRestart,this.augment)})}),this.allModules.forEach(s=>{this.container.get(s)});const i=this.options.loading??"normal";i==="normal"?this.load():i==="lazy"&&(this.IO=new IntersectionObserver(this.onVisibilityCheck,{root:null,rootMargin:"50px",threshold:0}),this.IO.observe(this.options.container))}onVisibilityCheck=t=>{t.forEach(e=>{if(e.isIntersecting)return this.load(),this.IO?.disconnect(),void(this.IO=null)})};augment=t=>{Object.entries(t).forEach(([e,i])=>{this[e]=i})};load=t=>{t&&Object.assign(this.options,t),this.started?this.onRestart():(this.onStart(),this.started=!0)};dispose=()=>{this.IO?.disconnect(),this.IO=null;const t=this.options.container;for(;t.firstChild;)t.firstChild.remove();this.onDispose(),this.container.unbindAll()}}async function Jt(n){const t=async o=>await(async function(r,l){switch(r.type){case"text":return await l(r.text);case"file":return await(async function(a,h){return a.file.match(/\.md$/i)?await(async function(c,d){let u;try{const m=await fetch(c),f=await m.text(),y=f.match(/^---\n([\s\S]*?)\n---\n([\s\S]*)$/);u=y?await d(y[2]):await d(f)}catch{u="Failed to load content."}return u})(a.file,h):a.file.match(/\.(png|jpg|jpeg|gif|svg|webp)$/i)?`<img src="${a.file}" alt="${a.file.split("/").pop()}">`:a.file.match(/\.(mp3|wav)$/i)?`<audio src="${a.file}" controls></audio>`:""})(r,l);case"link":return`<a href="${r.url}" target="_blank" rel="nofollow">${r.url}</a>`;default:return""}})(o,n.markdownParser??(r=>r)),e=n.canvas.nodes??[],i=n.attachmentDir??"./";e.forEach(o=>{if(o.type==="file"&&!o.file.includes("http")){const r=o.file.split("/");o.file=i+r.pop()}});const s=[];return await Promise.all(e.map(async o=>s.push(await t(o)))),s.join("")}const Kt=["innerHTML"],oe=ht({__name:"vueComponent",props:{modules:{},canvas:{},attachmentDir:{},options:{},isPrerendering:{type:Boolean},theme:{}},async setup(n,{expose:t}){let e,i;const s=n,o=s.isPrerendering??!1,r=ct("viewerRef");let l=null;const a=o?([e,i]=dt(()=>Jt({canvas:s.canvas??{},attachmentDir:s.attachmentDir,...s.options})),e=await e,i(),e):"";return H(()=>s.theme,h=>l?.changeTheme(h)),H(()=>({canvas:s.canvas,attachmentDir:s.attachmentDir}),({canvas:h,attachmentDir:c})=>l?.load({canvas:h,attachmentDir:c})),ut(()=>{r.value&&(l=new Zt(Object.assign(s.options??{},{container:r.value,theme:s.theme,canvas:s.canvas,attachmentDir:s.attachmentDir}),s.modules))}),pt(()=>{l?.dispose(),l=null}),t({viewer:l}),(h,c)=>(ft(),mt("section",{ref_key:"viewerRef",ref:r,innerHTML:gt(a),style:{"max-height":"100vh","max-width":"100vw"}},null,8,Kt))}}),tt='<svg viewBox="-5.28 -5.28 34.56 34.56" fill="none"><path d="M4 9V5.6c0-.56 0-.84.109-1.054a1 1 0 0 1 .437-.437C4.76 4 5.04 4 5.6 4H9M4 15v3.4c0 .56 0 .84.109 1.054a1 1 0 0 0 .437.437C4.76 20 5.04 20 5.6 20H9m6-16h3.4c.56 0 .84 0 1.054.109a1 1 0 0 1 .437.437C20 4.76 20 5.04 20 5.6V9m0 6v3.4c0 .56 0 .84-.109 1.054a1 1 0 0 1-.437.437C19.24 20 18.96 20 18.4 20H15" stroke-width="2.4" stroke-linecap="round"/></svg>';class re extends w{_controlsPanel=null;_toggleCollapseBtn=null;_toggleFullscreenBtn=null;_zoomOutBtn=null;_zoomSlider=null;_zoomInBtn=null;_resetViewBtn=null;DM;IH;collapsed;get controlsPanel(){if(this._controlsPanel===null)throw b;return this._controlsPanel}get toggleCollapseBtn(){if(this._toggleCollapseBtn===null)throw b;return this._toggleCollapseBtn}get toggleFullscreenBtn(){if(this._toggleFullscreenBtn===null)throw b;return this._toggleFullscreenBtn}get zoomOutBtn(){if(this._zoomOutBtn===null)throw b;return this._zoomOutBtn}get zoomSlider(){if(this._zoomSlider===null)throw b;return this._zoomSlider}get zoomInBtn(){if(this._zoomInBtn===null)throw b;return this._zoomInBtn}get resetViewBtn(){if(this._resetViewBtn===null)throw b;return this._resetViewBtn}constructor(...t){super(...t),this.collapsed=this.options.controlsCollapsed??!1,this.DM=this.container.get(C),this.IH=this.container.get(R),this.DM.onToggleFullscreen.subscribe(this.updateFullscreenBtn),this.container.get(_).hooks.onRefresh.subscribe(this.updateSlider),this._controlsPanel=document.createElement("div"),this._controlsPanel.className="controls",this._controlsPanel.classList.toggle("collapsed",this.collapsed),p.applyStyles(this._controlsPanel,".controls{position:absolute;top:10px;right:10px;display:flex;align-items:center;transition:transform .2s;border-radius:8px;gap:10px}.controls.collapsed{transform:translate(calc(100% - 32px))}.controls.collapsed .collapse-button{transform:rotate(180deg)}.controls .controls-content{display:flex;gap:1px;align-items:center;border-radius:8px;overflow:hidden;background:var(--border);box-shadow:var(--shadow);outline:1px solid var(--border)}.controls button{background-color:var(--background-secondary)}.controls button:hover{background:var(--border)}.zoom-slider{width:100px;margin:0 10px}"),this._toggleCollapseBtn=document.createElement("button"),this._toggleCollapseBtn.className="collapse-button border-shadow-bg",this._toggleCollapseBtn.innerHTML='<svg viewBox="-3.6 -3.6 31.2 31.2" stroke-width=".4"><path d="M15.707 4.293a1 1 0 0 1 0 1.414L9.414 12l6.293 6.293a1 1 0 0 1-1.414 1.414l-7-7a1 1 0 0 1 0-1.414l7-7a1 1 0 0 1 1.414 0Z" /></svg>',this._controlsPanel.appendChild(this._toggleCollapseBtn);const e=document.createElement("div");e.className="controls-content",this._toggleFullscreenBtn=document.createElement("button"),this._toggleFullscreenBtn.innerHTML=tt,e.appendChild(this._toggleFullscreenBtn),this._zoomOutBtn=document.createElement("button"),this._zoomOutBtn.innerHTML='<svg viewBox="-1.2 -1.2 26.4 26.4"><path d="M6 12h12" stroke-width="2" stroke-linecap="round" /></svg>',e.appendChild(this._zoomOutBtn),this._zoomSlider=document.createElement("input"),this._zoomSlider.type="range",this._zoomSlider.className="zoom-slider",this._zoomSlider.min="-30",this._zoomSlider.max="30",this._zoomSlider.value="0",e.appendChild(this._zoomSlider),this._zoomInBtn=document.createElement("button"),this._zoomInBtn.innerHTML='<svg viewBox="-1.2 -1.2 26.4 26.4"><path d="M6 12h12m-6-6v12" stroke-width="2" stroke-linecap="round" /></svg>',e.appendChild(this._zoomInBtn),this._resetViewBtn=document.createElement("button"),this._resetViewBtn.innerHTML='<svg viewBox="-6 -6 30 30" stroke-width=".08"><path d="m14.955 7.986.116.01a1 1 0 0 1 .85 1.13 8 8 0 0 1-13.374 4.728l-.84.84c-.63.63-1.707.184-1.707-.707V10h3.987c.89 0 1.337 1.077.707 1.707l-.731.731a6 6 0 0 0 8.347-.264 6 6 0 0 0 1.63-3.33 1 1 0 0 1 1.131-.848zM11.514.813a8 8 0 0 1 1.942 1.336l.837-.837c.63-.63 1.707-.184 1.707.707V6h-3.981c-.89 0-1.337-1.077-.707-1.707l.728-.729a6 6 0 0 0-9.98 3.591 1 1 0 1 1-1.98-.281A8 8 0 0 1 11.514.813Z" /></svg>',e.appendChild(this._resetViewBtn),this._controlsPanel.appendChild(e),this.DM.data.container.appendChild(this._controlsPanel),this._toggleCollapseBtn.addEventListener("click",this.toggleCollapse),this._zoomInBtn.addEventListener("click",this.zoomIn),this._zoomOutBtn.addEventListener("click",this.zoomOut),this._zoomSlider.addEventListener("input",this.slide),this._resetViewBtn.addEventListener("click",this.DM.resetView),this._toggleFullscreenBtn.addEventListener("click",this.toggleFullscreen),this.augment({toggleControlsCollapse:this.toggleCollapse}),this.onDispose(this.dispose)}toggleCollapse=()=>{this.collapsed=!this.collapsed,this.controlsPanel.classList.toggle("collapsed",this.collapsed),this.collapsed||this.updateSlider()};zoomIn=()=>this.IH.zoom(1.3,this.DM.middleViewer());zoomOut=()=>this.IH.zoom(1/1.3,this.DM.middleViewer());slide=()=>this.IH.trueZoom(1.1**Number(this.zoomSlider.value)/this.DM.data.scale,this.DM.middleViewer());updateFullscreenBtn=t=>{this.toggleFullscreenBtn.innerHTML=t?'<svg viewBox="-40.32 -40.32 176.64 176.64"><path d="M30 60H6a6 6 0 0 0 0 12h18v18a6 6 0 0 0 12 0V66a5.997 5.997 0 0 0-6-6Zm60 0H66a5.997 5.997 0 0 0-6 6v24a6 6 0 0 0 12 0V72h18a6 6 0 0 0 0-12ZM66 36h24a6 6 0 0 0 0-12H72V6a6 6 0 0 0-12 0v24a5.997 5.997 0 0 0 6 6ZM30 0a5.997 5.997 0 0 0-6 6v18H6a6 6 0 0 0 0 12h24a5.997 5.997 0 0 0 6-6V6a5.997 5.997 0 0 0-6-6Z"/></svg>':tt};toggleFullscreen=()=>this.DM.shiftFullscreen();updateSlider=()=>{this.collapsed||(this.zoomSlider.value=String(this.scaleToSlider(this.DM.data.scale)))};scaleToSlider=t=>Math.log(t)/Math.log(1.1);dispose=()=>{this.toggleCollapseBtn.removeEventListener("click",this.toggleCollapse),this.zoomInBtn.removeEventListener("click",this.zoomIn),this.zoomOutBtn.removeEventListener("click",this.zoomOut),this.zoomSlider.removeEventListener("input",this.slide),this.resetViewBtn.removeEventListener("click",this.DM.resetView),this.toggleFullscreenBtn.removeEventListener("click",this.toggleFullscreen),this.controlsPanel.remove(),this._controlsPanel=null,this._toggleCollapseBtn=null,this._zoomInBtn=null,this._zoomOutBtn=null,this._zoomSlider=null,this._resetViewBtn=null,this._toggleFullscreenBtn=null}}class ae extends w{_minimapCtx=null;_viewportRectangle=null;_minimap=null;_minimapContainer=null;_toggleMinimapBtn=null;minimapCache={scale:1,centerX:0,centerY:0};DM;SM;collapsed;get minimap(){if(this._minimap===null)throw b;return this._minimap}get minimapCtx(){if(this._minimapCtx===null)throw b;return this._minimapCtx}get viewportRectangle(){if(this._viewportRectangle===null)throw b;return this._viewportRectangle}get minimapContainer(){if(this._minimapContainer===null)throw b;return this._minimapContainer}get toggleMinimapBtn(){if(this._toggleMinimapBtn===null)throw b;return this._toggleMinimapBtn}constructor(...t){super(...t),this.collapsed=this.options.minimapCollapsed??!1,this.container.get(_).hooks.onRefresh.subscribe(this.updateViewportRectangle),this.DM=this.container.get(C),this.SM=this.container.get(N),this._minimapContainer=document.createElement("div"),this._minimapContainer.className="minimap-container",p.applyStyles(this._minimapContainer,".minimap-container{position:absolute;bottom:10px;right:10px;display:flex;pointer-events:none;transition:transform .2s}.minimap-container.collapsed{transform:translate(calc(100% - 32px))}.toggle-minimap{margin:auto 10px 0 0;pointer-events:auto}.collapsed .toggle-minimap{transform:rotate(180deg)}.minimap{position:relative;pointer-events:none;width:200px;height:150px;overflow:hidden;border-radius:12px;transform-origin:0 0}.minimap .minimap-canvas{width:100%;height:100%}.minimap .viewport-rectangle{position:absolute;top:0;left:0;pointer-events:none;border-radius:6px;box-sizing:border-box;border:2px dashed var(--text)}@container (max-width: 768px){.container .minimap{transform:scale(.6)}.container .toggle-minimap{transform:translateY(-60px)}.collapsed .container .toggle-minimap{transform:translateY(-60px) rotate(180deg)}.container .minimap-container{transform:translateY(60px) translate(80px)}.container .minimap-container.collapsed{transform:translateY(60px) translate(calc(100% - 32px))}}"),this._toggleMinimapBtn=document.createElement("button"),this._toggleMinimapBtn.className="toggle-minimap collapse-button border-shadow-bg",this._toggleMinimapBtn.innerHTML='<svg viewBox="-3.6 -3.6 31.2 31.2" stroke-width=".4"><path d="M15.707 4.293a1 1 0 0 1 0 1.414L9.414 12l6.293 6.293a1 1 0 0 1-1.414 1.414l-7-7a1 1 0 0 1 0-1.414l7-7a1 1 0 0 1 1.414 0Z" /></svg>',this._minimapContainer.appendChild(this._toggleMinimapBtn),this._minimap=document.createElement("div"),this._minimap.className="minimap border-shadow-bg";const e=document.createElement("canvas");e.className="minimap-canvas",e.width=200,e.height=150,this._minimap.appendChild(e),this._minimapCtx=e.getContext("2d"),this._viewportRectangle=document.createElement("div"),this._viewportRectangle.className="viewport-rectangle",this._minimap.appendChild(this._viewportRectangle),this._minimapContainer.appendChild(this._minimap),this.DM.data.container.appendChild(this._minimapContainer),this._minimapContainer.classList.toggle("collapsed",this.collapsed),this._toggleMinimapBtn.addEventListener("click",this.toggleCollapse),p.resizeCanvasForDPR(e,e.width,e.height),this.augment({toggleMinimapCollapse:this.toggleCollapse}),this.onStart(this.start),this.onRestart(this.start),this.onDispose(this.dispose)}toggleCollapse=()=>{this.collapsed=!this.collapsed,this.minimapContainer.classList.toggle("collapsed",this.collapsed),this.collapsed||this.updateViewportRectangle()};start=()=>{const t=this.DM.data.nodeBounds;if(!t)return;const e=this.minimap.clientWidth,i=this.minimap.clientHeight,s=e/t.width,o=i/t.height;this.minimapCache.scale=.9*Math.min(s,o),this.minimapCache.centerX=e/2,this.minimapCache.centerY=i/2,this.minimapCtx.clearRect(0,0,e,i),this.minimapCtx.save(),this.minimapCtx.translate(this.minimapCache.centerX,this.minimapCache.centerY),this.minimapCtx.scale(this.minimapCache.scale,this.minimapCache.scale),this.minimapCtx.translate(-t.centerX,-t.centerY);const r=this.DM.data.canvasData;for(const l of r.edges)this.drawMinimapEdge(l);for(const l of r.nodes)this.drawMinimapNode(l);this.minimapCtx.restore()};drawMinimapNode=t=>{const e=this.SM.getColor(t.color);this.minimapCtx.fillStyle=e.border,p.drawRoundRect(this.minimapCtx,t.x,t.y,t.width,t.height,25),this.minimapCtx.fill()};drawMinimapEdge=t=>{const e=this.DM.data.nodeMap,i=e[t.fromNode].ref,s=e[t.toNode].ref;if(!i||!s)return;const{x:o,y:r}=p.getAnchorCoord(i,t.fromSide),{x:l,y:a}=p.getAnchorCoord(s,t.toSide);this.minimapCtx.beginPath(),this.minimapCtx.moveTo(o,r),this.minimapCtx.lineTo(l,a),this.minimapCtx.strokeStyle=this.SM.getColor(t.color).active,this.minimapCtx.lineWidth=10,this.minimapCtx.stroke()};updateViewportRectangle=()=>{if(this.collapsed)return;const t=this.DM.data.nodeBounds,e=this.DM.data.container,i=this.DM.data.scale;if(!t)return;const s=e.clientWidth/i,o=e.clientHeight/i,r=-this.DM.data.offsetX/i+e.clientWidth/(2*i),l=-this.DM.data.offsetY/i+e.clientHeight/(2*i),a=this.minimapCache.centerX+(r-s/2-t.centerX)*this.minimapCache.scale,h=this.minimapCache.centerY+(l-o/2-t.centerY)*this.minimapCache.scale,c=s*this.minimapCache.scale,d=o*this.minimapCache.scale;this.viewportRectangle.style.left=`${a}px`,this.viewportRectangle.style.top=`${h}px`,this.viewportRectangle.style.width=`${c}px`,this.viewportRectangle.style.height=`${d}px`};dispose=()=>{this.toggleMinimapBtn.removeEventListener("click",this.toggleCollapse),this.minimapCtx.clearRect(0,0,this.minimap.clientWidth,this.minimap.clientHeight),this.minimapContainer.remove(),this._minimapContainer=null,this._toggleMinimapBtn=null,this._viewportRectangle=null,this._minimap=null}}class le extends w{_preventionContainer=null;preventMt=!1;DM;preventMistouch={record:!1,lastX:0,lastY:0,initialX:0,initialY:0};get preventionContainer(){if(this._preventionContainer===null)throw b;return this._preventionContainer}constructor(...t){super(...t);const e=document.createElement("div");e.className="prevention-banner border-shadow-bg",e.textContent=this.options.mistouchPreventerBannerText??"Click on to unlock.",this.DM=this.container.get(C),this._preventionContainer=document.createElement("div"),this._preventionContainer.className="prevention-container hidden",p.applyStyles(this._preventionContainer,".full,.prevention-container{top:0;left:0;width:100%;height:100%;position:absolute}.flex-center,.prevention-container{display:flex;justify-content:center;align-items:center}.prevention-container{overflow:visible;transition:background .2s,opacity .2s,box-shadow .2s,border .2s,filter .2s,backdrop-filter .2s}.prevention-container.hidden{pointer-events:none;opacity:0}.prevention-container .prevention-banner{border-radius:12px;padding:12px;margin:12px;font-size:calc(14px + .3vw);line-height:calc(17px + .3vw);text-align:center}"),this._preventionContainer.appendChild(e),this.DM.data.container.appendChild(this._preventionContainer),this.options.preventMistouchAtStart&&this.startPrevention(),window.addEventListener("pointerdown",this.onPointerDown),window.addEventListener("pointermove",this.onPointerMove),window.addEventListener("pointerup",this.onPointerUp),this.augment({startMistouchPrevention:this.startPrevention,endMistouchPrevention:this.endPrevention}),this.onDispose(this.dispose)}onPointerDown=t=>{const e=this.DM.data.container.getBoundingClientRect();t.clientX<e.left||t.clientX>e.right||t.clientY<e.top||t.clientY>e.bottom?this.preventMt||this.startPrevention():this.preventMt&&(this.preventMistouch.initialX=t.clientX,this.preventMistouch.initialY=t.clientY,this.preventMistouch.lastX=t.clientX,this.preventMistouch.lastY=t.clientY,this.preventMistouch.record=!0)};onPointerMove=t=>{this.preventMistouch.record&&(this.preventMistouch.lastX=t.clientX,this.preventMistouch.lastY=t.clientY)};onPointerUp=()=>{this.preventMistouch.record&&(this.preventMistouch.record=!1,Math.abs(this.preventMistouch.lastX-this.preventMistouch.initialX)+Math.abs(this.preventMistouch.lastY-this.preventMistouch.initialY)<5&&this.endPrevention())};startPrevention=()=>{this.preventionContainer.classList.remove("hidden"),this.DM.data.container.classList.add("numb"),this.preventMt=!0};endPrevention=()=>{this.preventMt=!1,this.preventionContainer.classList.add("hidden"),setTimeout(()=>this.DM.data.container.classList.remove("numb"),50)};dispose=()=>{window.removeEventListener("pointerdown",this.onPointerDown),window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),this.preventionContainer.remove(),this._preventionContainer=null}}const he={edges:[{id:"69024ca37afac075",styleAttributes:{},fromNode:"05070749b6678ecb",fromSide:"bottom",toNode:"ad03bace3d526a2d",toSide:"top",color:"6",label:"After Processing"},{id:"1ec2644450457af2",styleAttributes:{},fromNode:"7879f90910615218",fromSide:"left",toNode:"dd6210669d6e7586",toSide:"left",color:"5"},{id:"3d50d033d2b95cd0",styleAttributes:{path:"short-dashed"},fromNode:"dd6210669d6e7586",fromSide:"right",toNode:"7879f90910615218",toSide:"right",color:"5",label:"Forward Ref"},{id:"69d26e847f46bc42",styleAttributes:{},fromNode:"3be1cd40924f4ff1",fromSide:"right",toNode:"7879f90910615218",toSide:"right",color:"5"},{id:"3385235c6a13cb58",styleAttributes:{},fromNode:"3be1cd40924f4ff1",fromSide:"right",toNode:"f188948a86462f74",toSide:"right",color:"5"},{id:"c44cdfc12c9eba05",styleAttributes:{},fromNode:"5750528f086cf0dd",fromSide:"left",toNode:"f188948a86462f74",toSide:"left",color:"5"},{id:"44bab6781ea91ad3",styleAttributes:{},fromNode:"5750528f086cf0dd",fromSide:"left",toNode:"dd6210669d6e7586",toSide:"left",color:"5"},{id:"07c96354cd6ccc4a",styleAttributes:{},fromNode:"5750528f086cf0dd",fromSide:"left",toNode:"7879f90910615218",toSide:"left",color:"5"},{id:"4cefa24f7400341a",styleAttributes:{},fromNode:"5750528f086cf0dd",fromSide:"left",toNode:"3be1cd40924f4ff1",toSide:"left",color:"5"},{id:"f407467a654f1841",styleAttributes:{},fromNode:"22232f8a6f091b5e",fromSide:"right",toNode:"5750528f086cf0dd",toSide:"left",color:"5"},{id:"cee4aff4dc6dd164",styleAttributes:{},fromNode:"22232f8a6f091b5e",fromSide:"right",toNode:"f188948a86462f74",toSide:"left",color:"5"},{id:"e127e8106fbb9b8a",styleAttributes:{},fromNode:"22232f8a6f091b5e",fromSide:"right",toNode:"dd6210669d6e7586",toSide:"left",color:"5"},{id:"ec4a2b2f91a2c327",styleAttributes:{},fromNode:"22232f8a6f091b5e",fromSide:"right",toNode:"7879f90910615218",toSide:"left",color:"5"},{id:"bf7af48c1a778405",styleAttributes:{},fromNode:"22232f8a6f091b5e",fromSide:"right",toNode:"3be1cd40924f4ff1",toSide:"left",color:"5"},{id:"cbc78d17ed306141",styleAttributes:{},fromNode:"22232f8a6f091b5e",fromSide:"right",toNode:"3a6b316c15b9dfd8",toSide:"left",color:"5"},{id:"c863cc3999863aa4",styleAttributes:{},fromNode:"3484cb50304a8f95",fromSide:"right",toNode:"05070749b6678ecb",toSide:"left",color:"6"},{id:"174e433f44b17c80",styleAttributes:{},fromNode:"e0807693f63ec21e",fromSide:"right",toNode:"05070749b6678ecb",toSide:"left",color:"6"},{id:"852629e4effecdb5",styleAttributes:{},fromNode:"3d072911e8eb02c7",fromSide:"right",toNode:"05070749b6678ecb",toSide:"left",color:"6"},{id:"7f2dfd4cb35a72a5",styleAttributes:{},fromNode:"222011ffbe3e170b",fromSide:"right",toNode:"05070749b6678ecb",toSide:"left",color:"6"},{id:"5293a076e8cae9ee",styleAttributes:{},fromNode:"07bdb2d1ee50513b",fromSide:"right",toNode:"05070749b6678ecb",toSide:"left",color:"6"},{id:"8bcb6e002caa7462",styleAttributes:{},fromNode:"04726f1b68830bc2",fromSide:"right",toNode:"05070749b6678ecb",toSide:"left",color:"6"},{id:"6b78025b58507afe",styleAttributes:{},fromNode:"ad03bace3d526a2d",fromSide:"left",toNode:"43c6ee8f4e535cc9",toSide:"right",color:"6"},{id:"65f15bad81c4f4f3",styleAttributes:{},fromFloating:!1,fromNode:"6f2874961565b1a9",fromSide:"top",toNode:"22232f8a6f091b5e",toSide:"bottom",color:"5"},{id:"95150de3cd517bae",styleAttributes:{},fromNode:"62c0bf430454e577",fromSide:"right",toNode:"1e4c16e7d7eaf055",toSide:"left"},{id:"7179314583e20608",styleAttributes:{},toFloating:!1,fromNode:"d53b08a635029dc8",fromSide:"left",toNode:"6f2874961565b1a9",toSide:"right",color:"5"},{id:"3f2c19f968c5d664",styleAttributes:{},toFloating:!1,fromFloating:!1,fromNode:"1ae6fa286a80276c",fromSide:"right",toNode:"05070749b6678ecb",toSide:"left",color:"6"},{id:"e43e50cee761f200",styleAttributes:{},toFloating:!1,fromNode:"5750528f086cf0dd",fromSide:"left",toNode:"4640b4e7b1c2817f",toSide:"left",color:"5"},{id:"0c8afceb49f386c8",styleAttributes:{},toFloating:!1,fromFloating:!1,fromNode:"4640b4e7b1c2817f",fromSide:"right",toNode:"3be1cd40924f4ff1",toSide:"right",color:"5"},{id:"08a9b86c8cc587a5",styleAttributes:{},toFloating:!1,fromFloating:!1,fromNode:"4640b4e7b1c2817f",fromSide:"right",toNode:"7879f90910615218",toSide:"right",color:"5"},{id:"617fe3d9880b1c50",styleAttributes:{},toFloating:!1,fromFloating:!1,fromNode:"4640b4e7b1c2817f",fromSide:"right",toNode:"f188948a86462f74",toSide:"right",color:"5"}],metadata:{frontmatter:{},version:"1.0-1.0"},nodes:[{id:"9d2fd1cf9560b5cf",type:"group",x:980,y:580,width:478,height:240,color:"1",label:"Main Class"},{id:"35c44106f4320a95",type:"group",x:980,y:-20,width:478,height:240,color:"3",label:"Renderer"},{id:"3a71c9fbd8775a12",type:"group",x:980,y:280,width:478,height:240,color:"3",label:"Data Manager"},{id:"fc8278214b199cdb",type:"group",x:980,y:-620,width:478,height:240,color:"3",label:"Overlay Manager"},{id:"ecc016305ff46026",type:"group",x:980,y:-320,width:478,height:240,color:"3",label:"Interaction Hander"},{id:"197ccbfc946052f6",type:"group",x:980,y:-920,width:478,height:240,color:"3",label:"Style Manager"},{id:"3d271e1f35d6cefb",type:"group",x:980,y:-1200,width:478,height:220,color:"3",label:"Controller"},{id:"89d1ce7cd68dbeed",type:"group",x:980,y:-1440,width:478,height:180,color:"3",label:"Custom Module"},{id:"3d072911e8eb02c7",styleAttributes:{},text:`<h3 id="interface" tabindex="-1">Interface <a class="header-anchor" href="#interface" aria-label="Permalink to Interface">&#8203;</a></h3>
`,type:"text",x:1e3,y:-600,width:440,height:60},{id:"7879f90910615218",styleAttributes:{},text:`<h3 id="logic" tabindex="-1">Logic <a class="header-anchor" href="#logic" aria-label="Permalink to Logic">&#8203;</a></h3>
<p><strong>Work</strong>: Constructs interactive canvas elements and manages element interactions and rendering.</p>
`,type:"text",x:1e3,y:-520,width:440,height:119},{id:"222011ffbe3e170b",styleAttributes:{},text:`<h3 id="interface" tabindex="-1">Interface <a class="header-anchor" href="#interface" aria-label="Permalink to Interface">&#8203;</a></h3>
`,type:"text",x:1e3,y:-300,width:440,height:60},{id:"dd6210669d6e7586",styleAttributes:{},text:`<h3 id="logic" tabindex="-1">Logic <a class="header-anchor" href="#logic" aria-label="Permalink to Logic">&#8203;</a></h3>
<p><strong>Work</strong>: Uses <a href="https://pointeract.consensia.cc" target="_blank" rel="noreferrer">Pointeract</a> to listen to interactions on the viewer and translate to <code>DataManager</code> method calls.</p>
`,type:"text",x:1e3,y:-220,width:440,height:120},{id:"07bdb2d1ee50513b",styleAttributes:{},text:`<h3 id="interface" tabindex="-1">Interface <a class="header-anchor" href="#interface" aria-label="Permalink to Interface">&#8203;</a></h3>
`,type:"text",x:1e3,y:0,width:440,height:60},{id:"f188948a86462f74",styleAttributes:{},text:`<h3 id="logic" tabindex="-1">Logic <a class="header-anchor" href="#logic" aria-label="Permalink to Logic">&#8203;</a></h3>
<p><strong>Work</strong>: Renders all groups, edges and labels that doesn't need interactivity.</p>
`,type:"text",x:1e3,y:80,width:440,height:120},{id:"04726f1b68830bc2",styleAttributes:{},text:`<h3 id="interface" tabindex="-1">Interface <a class="header-anchor" href="#interface" aria-label="Permalink to Interface">&#8203;</a></h3>
`,type:"text",x:1e3,y:300,width:440,height:60},{id:"5750528f086cf0dd",styleAttributes:{},text:`<h3 id="logic" tabindex="-1">Logic <a class="header-anchor" href="#logic" aria-label="Permalink to Logic">&#8203;</a></h3>
<p><strong>Work</strong>: Initializes the canvas, manages states, and provides canvas control mathods.</p>
`,type:"text",x:1e3,y:380,width:440,height:120},{id:"43c6ee8f4e535cc9",styleAttributes:{},text:`<h2 id="main-interface" tabindex="-1">Main Interface <a class="header-anchor" href="#main-interface" aria-label="Permalink to Main Interface">&#8203;</a></h2>
`,type:"text",x:1e3,y:600,width:440,height:60},{id:"d53b08a635029dc8",styleAttributes:{},text:`<h2 id="main-logic" tabindex="-1">Main Logic <a class="header-anchor" href="#main-logic" aria-label="Permalink to Main Logic">&#8203;</a></h2>
<p><strong>Work</strong>: Controls lazy loading, provides start and dispose hooks, and manages modules.</p>
`,type:"text",x:1e3,y:680,width:440,height:120},{id:"3484cb50304a8f95",styleAttributes:{},text:`<h3 id="interface" tabindex="-1">Interface <a class="header-anchor" href="#interface" aria-label="Permalink to Interface">&#8203;</a></h3>
`,type:"text",x:1e3,y:-1420,width:440,height:60},{id:"3a6b316c15b9dfd8",styleAttributes:{},text:`<h3 id="logic" tabindex="-1">Logic <a class="header-anchor" href="#logic" aria-label="Permalink to Logic">&#8203;</a></h3>
`,type:"text",x:1e3,y:-1340,width:440,height:60},{id:"3be1cd40924f4ff1",styleAttributes:{},text:`<h3 id="logic" tabindex="-1">Logic <a class="header-anchor" href="#logic" aria-label="Permalink to Logic">&#8203;</a></h3>
<p><strong>Work</strong>: Controls main render loop and handles viewer resize</p>
`,type:"text",x:1e3,y:-1100,width:440,height:100},{id:"e0807693f63ec21e",styleAttributes:{},text:`<h3 id="interface" tabindex="-1">Interface <a class="header-anchor" href="#interface" aria-label="Permalink to Interface">&#8203;</a></h3>
`,type:"text",x:1e3,y:-1180,width:440,height:60},{id:"4640b4e7b1c2817f",styleAttributes:{},text:`<h3 id="logic" tabindex="-1">Logic <a class="header-anchor" href="#logic" aria-label="Permalink to Logic">&#8203;</a></h3>
<p><strong>Work</strong>: Generates applies and caches color palette. Controls viewer theme toggling.</p>
`,type:"text",x:1e3,y:-820,width:440,height:119},{id:"1ae6fa286a80276c",styleAttributes:{},text:`<h3 id="interface" tabindex="-1">Interface <a class="header-anchor" href="#interface" aria-label="Permalink to Interface">&#8203;</a></h3>
`,type:"text",x:1e3,y:-900,width:440,height:60},{id:"05070749b6678ecb",styleAttributes:{textAlign:null},text:`<h3 id="central-type-machine" tabindex="-1">Central Type Machine <a class="header-anchor" href="#central-type-machine" aria-label="Permalink to Central Type Machine">&#8203;</a></h3>
`,type:"text",x:1920,y:-460,width:320,height:60},{id:"ad03bace3d526a2d",styleAttributes:{},text:`<h3 id="all-available-options-and-main-class-augmentations" tabindex="-1">All Available Options and Main Class Augmentations <a class="header-anchor" href="#all-available-options-and-main-class-augmentations" aria-label="Permalink to All Available Options and Main Class Augmentations">&#8203;</a></h3>
`,type:"text",x:1920,y:580,width:320,height:100},{id:"6f2874961565b1a9",styleAttributes:{},text:`<h3 id="received-options-and-augmentations" tabindex="-1">Received Options and Augmentations <a class="header-anchor" href="#received-options-and-augmentations" aria-label="Permalink to Received Options and Augmentations">&#8203;</a></h3>
`,type:"text",x:160,y:708,width:440,height:65},{id:"22232f8a6f091b5e",styleAttributes:{},text:`<h3 id="coordinator" tabindex="-1">Coordinator <a class="header-anchor" href="#coordinator" aria-label="Permalink to Coordinator">&#8203;</a></h3>
<ul>
<li>Start/dispose hooks</li>
<li>DI container</li>
</ul>
`,type:"text",x:265,y:-525,width:230,height:130},{file:"https://github.com/hesprs/json-canvas-viewer/raw/main/assets/logo.svg",id:"62c0bf430454e577",type:"file",x:2360,y:-960,width:400,height:400},{id:"5a670d40836205ec",type:"link",url:"https://jsoncanvas.org",x:2360,y:-380,width:1020,height:710},{id:"1e4c16e7d7eaf055",styleAttributes:{},text:`<h2 id="learn-more" tabindex="-1">Learn More <a class="header-anchor" href="#learn-more" aria-label="Permalink to Learn More">&#8203;</a></h2>
<ul>
<li><a href="https://github.com/hesprs/json-canvas-viewer/wiki/1-%F0%9F%9A%80-Quick-Start#-chimpanzee-version" target="_blank" rel="noreferrer">Deadly simple chimp usage</a></li>
<li><a href="https://github.com/hesprs/json-canvas-viewer/wiki/1-%F0%9F%9A%80-Quick-Start#-full-version" target="_blank" rel="noreferrer">Full setup</a></li>
<li><a href="https://github.com/hesprs/json-canvas-viewer/wiki/1-%F0%9F%9A%80-Quick-Start#-vite" target="_blank" rel="noreferrer">Vite plugin</a></li>
<li><a href="https://github.com/hesprs/json-canvas-viewer/wiki/1-%F0%9F%9A%80-Quick-Start#-webpack" target="_blank" rel="noreferrer">Webpack loader and plugin</a></li>
<li><a href="https://github.com/hesprs/json-canvas-viewer/wiki/4-%F0%9F%96%87%EF%B8%8F-Prerendering-and-Bridges#vue-component" target="_blank" rel="noreferrer">Use as a Vue component</a></li>
<li><a href="https://github.com/hesprs/json-canvas-viewer/wiki/4-%F0%9F%96%87%EF%B8%8F-Prerendering-and-Bridges#react-component" target="_blank" rel="noreferrer">Use as a React component</a></li>
<li><a href="https://github.com/hesprs/json-canvas-viewer/wiki/4-%F0%9F%96%87%EF%B8%8F-Prerendering-and-Bridges#prerendering" target="_blank" rel="noreferrer">Prerendering</a></li>
<li><a href="https://github.com/hesprs/json-canvas-viewer/wiki/3-%F0%9F%A7%A9-Modules" target="_blank" rel="noreferrer">Optional modules</a></li>
<li><a href="https://github.com/hesprs/json-canvas-viewer/wiki/5-%F0%9F%A7%91%E2%80%8D%F0%9F%92%BB-Develop-a-Module" target="_blank" rel="noreferrer">Extend the viewer</a></li>
</ul>
`,type:"text",x:2820,y:-960,width:560,height:400}]};export{le as a,he as c,oe as l,ae as p,re as r};
